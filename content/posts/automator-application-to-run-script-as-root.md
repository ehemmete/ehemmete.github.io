---
title: 'Automator application to run script as root'
date: Tue, 12 Dec 2017 15:36:31 +0000
draft: false
tags: ['Automator', 'High Sierra', 'OS X General', 'Shell Script']
---

I was recently asked to create a shortcut on our users' Desktops to kick off the High Sierra install. We are caching the installer through our management system. In the past I have created a shortcut to the installer on their Desktop, but that required them to click through the many continue buttons. This method will use the startosinstall script from [Slack member @bp](https://github.com/bp88/JSS-Scripts/blob/master/OS_Upgrade.sh) to start the install with minimal user interaction. I wrap that shell script (with the appropriate modifications for my environment) in an Automator application, but to have the script run as root, I call it with Run AppleScript using the `do shell script ... with administrator privileges` form. ![AutomatorInstaller.png](https://sneakypockets.wordpress.com/wp-content/uploads/2017/12/automatorinstaller.png) The full AppleScript is

> `on run {input, parameters} set myPath to POSIX path of (path to me) set upgradeScript to myPath & "Contents/Resources/HighSierra_Upgrade.sh" do shell script quoted form of upgradeScript with administratorÂ privileges return input end run`

First the script finds the path to the Automator application and then I define the script to run based on that. This lets me embed the script in the application itself for easy deployment. To embed the script, save the Automator application somewhere. Then right click it and choose Show Package Contents. This will open a Contents folder. Expand that and find Resources. Copy the shell script into there. Keep in mind any time you change the Automator workflow and re-save you will need to re-copy the script into the application bundle. ![ApplicationBundle.png](https://sneakypockets.wordpress.com/wp-content/uploads/2017/12/applicationbundle.png) Then to finish off the application to look nice, open the Get Info window of the application and of the actually Install macOS High Sierra.app. Click once on the icon of the real installer to highlight it and copy it (command-C). Then click once on the icon of our Automator application to select it and paste the copied icon (command-V). Now our application has the nice installer icon for it. ![CopyIcon.png](https://sneakypockets.wordpress.com/wp-content/uploads/2017/12/copyicon.png) When the user runs this they will prompted for the credentials to run the script as root. Then they will be prompted by the script for their password to setup a FileVault authenticated restart. If I could figure out a way to combine those, it would make the process smoother, but I'm not sure if it is possible. ![AuthForsudo.png](https://sneakypockets.wordpress.com/wp-content/uploads/2017/12/authforsudo.png) ![AuthForRestart.png](https://sneakypockets.wordpress.com/wp-content/uploads/2017/12/authforrestart.png) ![PleaseWait.png](https://sneakypockets.wordpress.com/wp-content/uploads/2017/12/pleasewait.png) After that, the system reboots and the user sees the standard 'Installing: About X minutes remaining'.
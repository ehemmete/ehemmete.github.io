---
title: 'Creating a wrapper package for a choices.xml file'
date: Tue, 17 Mar 2020 18:46:06 +0000
draft: false
tags: ['OS X General', 'Packaging', 'Shell Script']
---

In a [previous article](https://sneakypockets.wordpress.com/2017/07/26/using-installer-choices-xml-to-modify-anyconnect-and-mcafee-deployments/), I discussed creating a choices.xml file to control what gets installed by a vendor package.  I briefly touched on how to use the choices.xml file, but don't give much detail.  In this post, I will spell out how to put the vendor package and choices.xml file in a wrapper package for deployment through anything that handles packages. For my example, I will be using Cisco's AnyConnect 4.8 package and a choices.xml file to only install the VPN portion.  Using [Stéphane Sudre's Packages](http://s.sudre.free.fr/Software/Packages/about.html) application, create a new raw package project. ![Screen Shot 2020-03-17 at 12.38.06 PM](https://sneakypockets.wordpress.com/wp-content/uploads/2020/03/screen-shot-2020-03-17-at-12.38.06-pm.png) Give it a useful name and decide where to save the project. ![Screen Shot 2020-03-17 at 12.38.24 PM](https://sneakypockets.wordpress.com/wp-content/uploads/2020/03/screen-shot-2020-03-17-at-12.38.24-pm.png)You can set Settings how you like, but the defaults generally work for what we are doing. Everything in this exercise will be in the Scripts tab. ![Screen Shot 2020-03-17 at 12.58.09 PM](https://sneakypockets.wordpress.com/wp-content/uploads/2020/03/screen-shot-2020-03-17-at-12.58.09-pm.png)Drag the AnyConnect.pkg and your choices.xml to the Additional Resources area.  You can name your xml file anything you want.  For example, I have choicesForAnyConnectVPN.xml and choicesForAnyConnectUmbrella.xml for 2 different package projects.  For AnyConnect, I also want to install our vpn configuration, so I add a Profiles folder with the vpn folder and the configuration in there. ![Screen Shot 2020-03-17 at 12.57.51 PM](https://sneakypockets.wordpress.com/wp-content/uploads/2020/03/screen-shot-2020-03-17-at-12.57.51-pm.png) My company's VPN requires a certificate, so that is added as well.![Screen Shot 2020-03-17 at 1.38.57 PM.png](https://sneakypockets.wordpress.com/wp-content/uploads/2020/03/screen-shot-2020-03-17-at-1.38.57-pm.png) The AnyConnect.pkg already looks for the Profiles directory in the same directory as the package. Now we need a post installation script to tell the installer binary to use our choices.xml file.  The first step is to find the path to the resources area, which is created by the installer process and cleaned up automatically.  The post install script will be running from that directory, so we can find the path with `​dirname`.  Then we tell installer about the choices.xml, the vendor package, and the target volume.  Lastly, I add the certificate to the System Keychain. https://gist.github.com/ehemmete/70396684d6ed91687ec4b7f85aa8961b Once the postinstall.sh is created, drag it to the Post-installation well, save your package, and build it. ![Screen Shot 2020-03-17 at 1.39.44 PM.png](https://sneakypockets.wordpress.com/wp-content/uploads/2020/03/screen-shot-2020-03-17-at-1.39.44-pm.png)I then [sign my packages](https://sneakypockets.wordpress.com/2016/11/04/signing-installer-packages-with-automator/) with a certificate from my company's Apple developer account. Lastly, a note about the target for `installer`. You could put `/` in for the target, but if there is a chance this package will be installed while booted from something other than the internal drive (much more common in the era of imaging), the package will be installed to the boot volume, not the correct target.  Using `$3` means put it on the target volume.  Rich Trouton mentions it under Installer Script Variables [here](https://derflounder.wordpress.com/2014/06/01/understanding-payload-free-packages/).  There are also mentions in the old PeachPit [Mac OS X Deployment](https://books.google.com/books?id=H3awpzaO7IwC&lpg=PA111&dq=%243%20The%20mount%20point%20of%20the%20destination%20volume&pg=PA111#v=onepage&q=$3%20The%20mount%20point%20of%20the%20destination%20volume&f=false) book.  \[edit\]And thanks to [Scripting OS X](https://scriptingosx.com) for the pointer to double quote `$3` in the post install script.  In these cases (where it isn't `/`) it will likely expand to `/Volumes/Macintosh HD/`​ and the space will cause a problem if not quoted.  He also points out that I hard coded the path to the System Keychain, but`security` won't be happy if `$3` isn't `/`, so this isn't as flexible as I intended.
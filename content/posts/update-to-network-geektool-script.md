---
title: 'Update to network GeekTool script'
date: Tue, 05 May 2015 21:06:11 +0000
draft: false
tags: ['OS X General', 'Shell Script', 'Yosemite']
---

I have been seeing a lot of noise in my logs about IO80211ScanManager scanning for Wi-Fi networks constantly.  I finally noticed that it was triggered by system\_profiler and realized that I was using system\_profiler to find my current Wi-Fi network and what channel I was connected to. See the original here: https://sneakypockets.wordpress.com/2014/08/30/network-services-and-ips/ So I changed how I find that data in my GeekTool script.  I also took the opportunity to simplify the whole thing a bit more.  Here is the new version: \[code language="bash"\] #! /bin/bash connection=false services=$(networksetup -listallnetworkservices) while read service; do ip=$(networksetup -getinfo "$service" | grep "IP address" | grep -v "IPv6" | awk '{print $3}') if \[ "$ip" != "" \]; then echo "$service : $ip" connection=true if \[ "$service" == "Wi-Fi" \]; then NetName=$(/System/Library/PrivateFrameworks/Apple80211.framework/Versions/Current/Resources/airport -I | grep SSID | grep -v BSSID | cut -d":" -f2 | tr -d '\[\[:space:\]\]') Channel=$(/System/Library/PrivateFrameworks/Apple80211.framework/Versions/Current/Resources/airport -I | grep channel | cut -d":" -f2 | tr -d '\[\[:space:\]\]') echo "$NetName / $Channel" fi fi done <<<"$services" if \[ $connection = false \]; then echo "No Connected Services" else extIP=$(curl -s http://checkip.dyndns.org/ | sed 's/\[a-zA-Z<>/ :\]//g') if \[ "$extIP" != "" \]; then echo "External IP: $extIP" else echo "No External Connection" fi fi \[/code\] Instead of system\_profiler the airport command to get the network name and channel.  This stopped the all the message in my logs. I also moved the name and channel logic into the main while read block. This prevents the name and channel from getting separated from the Wi-Fi network IP.
---
title: 'Shell to Swift with a bit of Python'
date: Mon, 29 Jul 2019 16:13:56 +0000
draft: false
tags: ['Swift']
---

This is probably the first of a couple of posts about this project. There are a couple of things I learned I want to expand on, but don't want to make this too long. So this will be an overview of the project. For years I have had a [shell script](https://sneakypockets.wordpress.com/2015/05/05/update-to-network-geektool-script/) that collected some network info and it was displayed on my desktop using [NerdTool](http://mutablecode.com/apps/nerdtool.html) and then [GeekTool](https://www.tynsoe.org/v2/geektool/). While testing macOS Catalina betas, GeekTool hasn't been working for me. The other concern with these options is that they run the shell script on a schedule which can be much to frequent or not frequent enough.  So I [rewrote it with Xcode in Swift](https://github.com/ehemmete/NetworkInfoGUI). I have [recently been doing more with Swift](https://sneakypockets.wordpress.com/2019/04/15/using-a-swift-app-to-get-rid-of-lots-of-applescript-dialogs/) and was inspired by [Macshome's workshop at PSU MacAdmin 2019](https://psumac2019.sched.com/event/KQo3/swift-xcode-an-app-and-you). In that workshop he showed off a nice Swift function for running shell scripts (he planned to opensource the workshop code, so I will link to it when I can). He also demonstrated how to store functions in one file and reference them in another which made for much cleaner and transportable code. I started with that and reproduced my network info output and that was working well. At this point the program was a cli command. ![Screen Shot 2019-07-26 at 8.38.25 PM.png](https://sneakypockets.wordpress.com/wp-content/uploads/2019/07/screen-shot-2019-07-26-at-8.38.25-pm-1.png)While it worked well in the terminal, I wanted to have the output available at a glance. I created a new Xcode project to create a GUI version. Because I had all my functions in a separate NetworkInfo.swift file, I was able to drag that into the GUI project and call them from there.  The main parts of the project now relied on ​​`​networksetup` to find all the network services and get the ip addresses of the active services and [looked like this](https://github.com/ehemmete/NetworkInfoGUI/blob/master/NetworkFunctions(shell-based).swift). Then I was further inspired by [zakes](https://macadmins.slack.com/archives/C056UTQ3M/p1563909962029100) and [frogor](https://macadmins.slack.com/archives/C056UTQ3M/p1563914551039800) in #python in the [MacAdmin Slack](http://macadmins.org) to try to use more native calls instead of shell commands.  They were using PyObjC to call native macOS methods, so it was pretty straight forward to use them in Swift after a bit of reading the documentation. I also got some help from [bp](https://macadmins.slack.com/archives/C0688BNEM/p1563637834003600) in #swift on getting nicer output from some of the methods. At this point, I could print all the output I wanted nicely, but only when the application is launched. I found [NWPathMonitor in Apple's documentation](https://developer.apple.com/documentation/network/nwpathmonitor) and with some trial and error, I was able to get the function to update the UI whenever the network state on the Mac changed.![Screen Shot 2019-07-26 at 8.56.45 PM.png](https://sneakypockets.wordpress.com/wp-content/uploads/2019/07/screen-shot-2019-07-26-at-8.56.45-pm.png) By moving from shell calls to native methods, the code runs much faster.  Using `time` to compare the two commands, the ProcessRunner version runs in 1.155s while the native command version runs in .243s. Certainly not a huge deal for something this simple, but shows the benefit of using the native tools when possible. Another benefit is that by using a native wrapping label in a standard window, the network info is now selectable and copyable. In another post, I plan to describe the structure of the project and how it monitors for network changes.  I also hope to figure out how to use the macOS native controls to allow a user to adjust the fonts, colors, and opacity of the display.  Finally, I would like to include the cli command in the GUI bundle, so it can be called from Terminal if needed.
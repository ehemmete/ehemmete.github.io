<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>My Thoughts</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="">
    <meta name="generator" content="Hugo 0.135.0">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      

    

    
    
      <link href="/posts/index.xml" rel="alternate" type="application/rss+xml" title="My Thoughts" />
      <link href="/posts/index.xml" rel="feed" type="application/rss+xml" title="My Thoughts" />
      
    

    
      <link rel="canonical" href="http://localhost:1313/posts/">
    

    <meta property="og:url" content="http://localhost:1313/posts/">
  <meta property="og:site_name" content="My Thoughts">
  <meta property="og:title" content="Posts">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="website">

  <meta itemprop="name" content="Posts">
  <meta itemprop="datePublished" content="2023-11-29T01:51:20+00:00">
  <meta itemprop="dateModified" content="2023-11-29T01:51:20+00:00">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Posts">

	
  </head>

  <body class="ma0 avenir bg-near-white">

    

  <header>
    <div class="pb3-m pb6-l bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        My Thoughts
      
    </a>
    <div class="flex-l items-center">
      

      
      
<div class="ananke-socials">
  
</div>

    </div>
  </div>
</nav>

      <div class="tc-l pv3 ph3 ph4-ns">
        <h1 class="f2 f-subheadline-l fw2 light-silver mb0 lh-title">
          Posts
        </h1>
        
      </div>
    </div>
  </header>


    <main class="pb7" role="main">
      
  <article class="pa3 pa4-ns nested-copy-line-height">
    <section class="cf ph3 ph5-l pv3 pv4-l f4 tc-l center measure-wide lh-copy mid-gray"></section>
    <section class="flex-ns flex-wrap justify-around mt5">
      
        <div class="relative w-100 w-30-l mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/macos-sierra-recovery-hd-changes-comments/" class="link black dim">
        macOS Sierra Recovery HD Changes
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h4 id="heading"></h4>
<p><a href="https://ExtremeLanding.com/" title="ExtremeLanding.com@gmail.com">Extreme Landing</a> - <!-- raw HTML omitted -->Jan 2, 2017<!-- raw HTML omitted --></p>
<p>I accidentally changed the ACLs permissions on my home folder and had the same problem on my MacBook Pro running macOS Sierra version 10.12.2 Follow the step below to changed the folders No Access permissions and revert back to Allow access: Restart with the Command and S keys held down, and run the following commands: mount -uw / chown root / chmod 1775 / exit &ndash; After the last command &ldquo;exit&rdquo; your system should restart on its own and everything should appear the same as the time before you changed the Home folder permissions. I hope this helps, Extreme Landing <a href="https://ExtremeLanding.com/">https://ExtremeLanding.com/</a></p>
    </div>
    <a href="/posts/macos-sierra-recovery-hd-changes-comments/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="relative w-100 w-30-l mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/macos-sierra-recovery-hd-changes/" class="link black dim">
        macOS Sierra Recovery HD Changes
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>[Update 7/20/17] As of 10.12.6 RepairHomePermissions still fails with error: Unable to launch the underlying task process.  Also my bug report has been marked as a  DUPLICATE OF 25393689. [Update 1/26/17] As of 10.12.3 RepairHomePermissions still fails with error: Unable to launch the underlying task process. One of the areas that hasn&rsquo;t gotten much coverage with the update to Sierra is the Recovery HD. This is the minimal OS environment that lets us do things like reinstall the OS, restore a Time Machine backup, and partition volumes before an install. The other thing that Recovery allows us to do is to reset forgotten passwords. Originally, we could do this by booting off the install CD/DVD. Once those went away Recovery HD gave us a Reset Password option in the Utilities menu. That went away in Yosemite(?) but we could get the same functionality by choosing Utilities -&gt; Terminal and running the resetpassword command. This reset password utility would also allow us to reset a users home folder permissions, including the default ACLs. Now with macOS Sierra v10.12, this has changed again. To start, boot to Recovery by holding down Command-R at startup.  You will end up at a screen like: <img src="https://sneakypockets.wordpress.com/wp-content/uploads/2016/09/screen-shot-2016-09-21-at-3-10-31-pm.png" alt="Screen Shot 2016-09-21 at 3.10.31 PM.png"> Then open the Utilities menu and choose Terminal:<img src="https://sneakypockets.wordpress.com/wp-content/uploads/2016/09/screen-shot-2016-09-21-at-3-10-55-pm.png" alt="Screen Shot 2016-09-21 at 3.10.55 PM.png"> In the Terminal window that open, run the resetpassword command to bring up a new assistant.<img src="https://sneakypockets.wordpress.com/wp-content/uploads/2016/09/screen-shot-2016-09-21-at-3-11-11-pm.png" alt="Screen Shot 2016-09-21 at 3.11.11 PM.png"> Select the user you need to reset the password of and click Next. <img src="https://sneakypockets.wordpress.com/wp-content/uploads/2016/09/screen-shot-2016-09-21-at-3-11-28-pm.png" alt="Screen Shot 2016-09-21 at 3.11.28 PM.png"> Then you can enter the new password and confirm it.  Add a hint if you want and click Next.<img src="https://sneakypockets.wordpress.com/wp-content/uploads/2016/09/screen-shot-2016-09-21-at-3-11-42-pm.png" alt="Screen Shot 2016-09-21 at 3.11.42 PM.png"> Finally you get confirmation of the change and can reboot.  Or if you open the Reset Password menu, you can quit to easily return to the Terminal.<img src="https://sneakypockets.wordpress.com/wp-content/uploads/2016/09/screen-shot-2016-09-21-at-3-11-57-pm.png" alt="Screen Shot 2016-09-21 at 3.11.57 PM.png"> The piece that is missing from all that is reseting home folder permissions.  It turns out there is a new tool to (try to) do this.  Back in your terminal, enter the command RepairHomePermissions and hit Enter.<img src="https://sneakypockets.wordpress.com/wp-content/uploads/2016/09/screen-shot-2016-09-21-at-3-12-28-pm.png" alt="Screen Shot 2016-09-21 at 3.12.28 PM.png"> Again an assistant opens and we can select the user whose home folder permissions we need to reset.  Click Next.<img src="https://sneakypockets.wordpress.com/wp-content/uploads/2016/09/screen-shot-2016-09-21-at-3-12-36-pm.png" alt="Screen Shot 2016-09-21 at 3.12.36 PM.png"> Unfortunately, at this time (Sierra v10.12 build 16A323) the process fails.<img src="https://sneakypockets.wordpress.com/wp-content/uploads/2016/09/screen-shot-2016-09-21-at-3-12-41-pm.png" alt="Screen Shot 2016-09-21 at 3.12.41 PM.png"> Again, you can reboot or Quit the RepairHomePermissions assistant (interestingly called ResetPassword in the menu bar). Note that RepairHomePermissions is available in a full Sierra install, but fails even sooner when run as it tries to reference /System/Installation/CDIS/KeyRecoveryAssistant.app/Contents/MacOS/KeyRecoveryAssistant, which doesn&rsquo;t exist on a standard install. Also both of these assistants will have you unlock a FileVaulted drive before asking you which user to work with. Thanks to MacAdmin Slack members mikethefifth, for asking about reseting home folder permissions which prompted these tests, and owen.pragel, for sharing the new command list that included the tantalizing RepairHomePermissions and for finding the reference to KeyRecoveryAssistant. Update: I have filed a bug about RepairHomePermissions not working. https://openradar.appspot.com/28431470</p>
    </div>
    <a href="/posts/macos-sierra-recovery-hd-changes/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="relative w-100 w-30-l mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/capturing-information-while-running-casper-imaging/" class="link black dim">
        Capturing information while running Casper Imaging
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I recently changed jobs and am now managing a JAMF Casper suite that really hadn&rsquo;t had much done to it before. Previous imaging was done via a monolithic image with Clonezilla and a lot of hand configuration. The Windows environment here is much more mature and one of the things that is done on the Windows side is to capture information about the build as it happens. This post is about replicating that on the Macs when using Casper Imaging. Sidenote: I hope to move to DEP soon and stop most of the imaging that happens here, but until then&hellip; Our basic workflow is to boot from a flash drive created from an AutoCasperNBI image. From there Casper Imaging launches, is configured, and the process starts. The first thing in our configuration is a script that prompts for the builder&rsquo;s Tech ID, their AD password, the user ID for the person this computer is assigned to, which part of the business they are in, and what country this computer is going to. The script also records the start time and date of the build as well as the time zone offset (more on that later). This data is written to flat files stored in /tmp/tags/. Then the rest of the install happens, OS is block copied, application packages run, and a second script copies the output of the first script to the newly installed internal drive; /Volumes/Macintosh\ HD/opt/wkstnctl/tags. This is the location that our BigFix install was looking for information from the cloned/hand configured systems. Then the client reboots and does the rest of the package installs and configuration that has to happen while booted to the &ldquo;real&rdquo; OS. The last thing that runs before the final reboot is a script to capture the time the build completes. This is where the time zone offset comes in. I can&rsquo;t rely on the client to have the right time zone at this point. I tried (with help - Thanks MacAdmin Slack) to trigger the system to adjust the time zone automatically, but couldn&rsquo;t make it automatic. So this is where the time zone offset comes into play. I have the original time zone offset and then get the current one and do the math to record completion time that matches the start time. Here is the first script (CaptureBuildInfo.sh) (priority 1): [code language=&ldquo;bash&rdquo;] #!/bin/sh # Capture build info including start time, tech ID, and intended user ID mkdir -p /tmp/tag/ # Record start time and time zone offset echo &quot;$(date +&quot;%D %H:%M&quot;)&quot; &gt; /tmp/tag/BuildStarted.txt echo &quot;$(date +&quot;%z&quot;)&quot; &gt; /tmp/tag/TimeZoneOffset.txt # Some variable defaults for tests techName=&quot;&quot; techNameTest=&quot;false&quot; pwTest=&quot;kinit: Password incorrect&quot; pwCounter=0 endUser=&quot;&quot; endUserTest=&quot;false&quot; pwFileName=&quot;$(uuidgen).txt&quot; #Enter in the URL of the JSS we are are pulling info from. (NOTE: We will need https:// and :8443 (or whatever port you use). Example: <a href="https://jss.company.com:8443">https://jss.company.com:8443</a> ) jssURL=&quot;https://my.jss.tld:8443&quot; #URL for checking with AD adURL=$(host -t SRV _ldap._tcp.my.domain.tld | head -n1 | cut -d&quot; &quot; -f 8 | sed -e &rsquo;s/.$//&rsquo;) #Enter in a username and password that has the correct permissions to the JSS API for what data we need. Read Access to Accounts. jssUser=&quot;apiuser&quot; jssPass=&quot;apipassword!&quot; #Name for XML files pulled from JSS declare -x UserXML=&quot;/tmp/users.xml&quot; #Get list of users from JSS /usr/bin/curl -k -s -u &quot;$jssUser&quot;:&quot;$jssPass&quot; &quot;$jssURL&quot;/JSSResource/accounts -X GET -o &quot;$UserXML&quot; ######################################################################### # Collect and test Tech ID name against JSS imaging accounts # while the entered name all lower case doesn&rsquo;t equal the JSS based name all lower case while [[ $(echo &quot;$techName&quot; | tr [:upper:] [:lower:]) != $(echo &quot;$techNameTest&quot; | tr [:upper:] [:lower:]) ]]; do techName=`/usr/bin/osascript &lt;&lt;EOT tell application &quot;System Events&quot; with timeout of 43200 seconds activate set myReply to text returned of (display dialog &quot;Please enter your Tech ID (first.last):&quot; default answer &quot;&quot; buttons {&quot;Continue&quot;} default button &quot;Continue&quot;) end timeout end tell EOT` # check if collected name is in the list pulled from the JSS # techNameTest will equal the name stored in the JSS if this succeeds # techNameTest will equal &quot;&quot; if this fails techNameTest=$(xmllint &quot;$UserXML&quot; &ndash;xpath &quot;/accounts/users/user/name&quot; | sed &rsquo;s/&lt;name&gt;//g&rsquo; | sed -e $&rsquo;s/&lt;\/name&gt;/\\\n/g&rsquo; | grep -i -m 1 -F &quot;$techName&quot;) done #write the Tech ID to our plist for collection later echo &quot;$techNameTest&quot; &gt; /tmp/tag/TechID.txt ######################################################################### # collect and test Tech password while [ &quot;$pwTest&quot; == &quot;kinit: Password incorrect&quot; ] &amp;&amp; [ $pwCounter -lt 2 ]; do techPW=`/usr/bin/osascript &lt;&lt;EOT tell application &quot;SystemUIServer&quot; with timeout of 43200 seconds activate set myReply to text returned of (display dialog &quot;Please enter your Tech ID password:&quot; with hidden answer default answer &quot;&quot; buttons {&quot;Continue&quot;} default button &quot;Continue&quot;) end timeout end tell EOT` # increment the counter so that we only try twice. Don&rsquo;t want to lock an account pwCounter=$[$pwCounter+1] # sadly, write the password out to a file for the next step echo &quot;$techPW&quot; &gt; /tmp/$pwFileName # Try to authenticate as the tech using the password file # pwTest will equal &quot;kinit: Password incorrect&quot; if the password is wrong. # pwTest will equal &quot;&quot; if the password is right pwTest=$(kinit &ndash;password-file=/tmp/$pwFileName &quot;${techNameTest}@AM.JLLNET.COM&quot; 2&gt;&amp;1 &gt;/dev/null) #OLD and insecure pwTest=$(ldapwhoami -vvv -h &quot;$adURL&quot; -D &quot;${techNameTest}@am.jllnet.com&quot; -x -w &quot;$techPW&quot; | grep Success) #securely erase the password file srm /tmp/$pwFileName done # If they have tried twice and still failed, bail out so as to not lock their account if [ $pwCounter = 2 ] &amp;&amp; [ &quot;$pwTest&quot; == &quot;kinit: Password incorrect&quot; ]; then /usr/bin/osascript &lt;&lt;EOT tell application &quot;SystemUIServer&quot; with timeout of 43200 seconds display dialog &quot;This script can not authenticate you and doesn&rsquo;t want to lock you out of your account. Please verify your password elsewhere and try again.&quot; default button &quot;Cancel&quot; end timeout end tell EOT exit 1 fi ######################################################################### # Collect and test end user id # while the typed name does not equal a name found in AD, keep asking while [[ $(echo &amp;quot;$endUserTest&amp;quot; | tr [:upper:] [:lower:]) != $(echo &amp;quot;$endUser&amp;quot; | tr [:upper:] [:lower:]) ]]; do endUser=`/usr/bin/osascript &amp;lt;&amp;lt;EOT tell application &amp;quot;SystemUIServer&amp;quot; with timeout of 43200 seconds activate set myReply to text returned of (display dialog &amp;quot;Please enter the end user&rsquo;s ID (first.last):&amp;quot; default answer &amp;quot;&amp;quot; buttons {&amp;quot;Continue&amp;quot;} default button &amp;quot;Continue&amp;quot;) end timeout end tell EOT` # check collected name against AD # endUserTest should equal the proper user name from AD if this succeeds # endUserTest will equal &quot;&quot; if this fails #OLD and insecure endUserTest=$(ldapsearch -LLL -x -h &quot;$adURL&quot; -D &quot;${techNameTest}@am.jll.com&quot; -w &quot;$techPW&quot; -b &quot;dc=am,dc=jllnet,dc=com&quot; &quot;(&amp;(objectCategory=Person)(objectClass=User)(sAMAccountName=$endUser))&quot; sAMAccountName | grep sAMAccountName | cut -d&quot; &quot; -f 2) endUserTest=$(ldapsearch -LLL -H &quot;ldap://${adURL}&quot; -b &quot;dc=am,dc=jllnet,dc=com&quot; &quot;(&amp;(objectCategory=Person)(objectClass=User)(sAMAccountName=$endUser))&quot; sAMAccountName 2&gt;/dev/null | grep sAMAccountName | cut -d&quot; &quot; -f 2) done # write the end user info to the plist echo &quot;$endUserTest&quot; &gt; /tmp/tag/JLL_SAM.txt echo &quot;${endUserTest}@am.jll.com&quot; &gt; /tmp/tag/JLL_UserEmailID.txt echo &quot;${endUserTest}@am.jll.com&quot; &gt; /tmp/tag/JLL_UserUPN.txt ######################################################################### # Collect the Business ID from a list businessID=`/usr/bin/osascript &lt;&lt;EOT tell application &quot;SystemUIServer&quot; activate with timeout of 600 seconds set businessID to (choose from list {&quot;Unit 1&quot;, &quot;Unit 2&quot;, &quot;Unit 3&quot;} with prompt &quot;Choose the appropriate\nbusiness unit:&quot; default items {&quot;Unit 1&quot;}) end timeout end tell EOT` #store the business id echo &quot;$businessID&quot; &gt; /tmp/tag/BusinessID.txt ######################################################################### # Collect the Country ID from a list countryID=`/usr/bin/osascript &lt;&lt;EOT tell application &quot;SystemUIServer&quot; activate with timeout of 600 seconds set businessID to (choose from list {&quot;US&quot;, &quot;CA&quot;, &quot;MX&quot;, &quot;SA&quot;} with prompt &quot;Choose the appropriate country:&quot; default items {&quot;US&quot;}) end timeout end tell EOT` #store the country ID echo &quot;$countryID&quot; &gt; /tmp/tag/CountryID.txt #store build version number echo &quot;2.0.0&quot; &gt; /tmp/tag/BuildVersion.txt [/code] It starts by creating a &ldquo;tag&rdquo; directory in /tmp on the boot drive. Then it uses the date command to record the start time and date in the format my organization wants. Then the date command is used again to record the time zone offset with the %z formatting. I then set some default values for variables that will be part of tests later. I also create a unique filename for briefly storing a password later (this is not ideal, but you will see why later). Then I define my JSS address, look up a domain controller, and enter authentication information for a user with JSS API read access. Be sure to adjust these to match your environment. Next I pull a list of accounts from the JSS with the API user and store this in a file (also in /tmp). Now we are ready to prompt for the installers Tech ID. The first time through the test will fail as the two variables are set to not be the same. So then the osascript (AppleScript) will run and collect the users name. That value is used to compare (case insensitive) to the list of accounts on the JSS that was saved earlier. If these match, the test is matched and we move on. Otherwise, the osascript will run again and the installer can try again. Once this is successful, the Tech ID is saved to the tags. Next use a similar loop to check the tech&rsquo;s password. The osascript prompts for a password with a hidden answer. The password is stored in the unique file defined above. As the JSS is populated from our AD, I check the password against AD using kinit. If this is successful, we can break out of the loop and also get a Kerberos ticket granting ticket, which we will use in a bit. If the kinit fails, the tech gets one more chance. If they fail twice, we give up so as to not lock their AD account. Once the kinit has run, I securely remove the password file. At this point we have a valid AD user account that is also allowed on the JSS and that user has a TGT from AD. I then prompt for the ID of the end user this computer will go to. Using the tech&rsquo;s ID and TGT I securely query AD to confirm that the end user ID exists. Once this ldapsearch is successful, the loop exits and the account ID is written to tags for SAM, and then a built email and UPN. The script then prompts for the business unit and country this computer is going to. An osascript shows a list with our most common answer selected by default. These are then stored in tags to be used later for policies to customize the systems. Lastly, the image version is written to a tag. Later in the configuration, script two (CopyBuildInfo.sh) runs (priority 10). [code language=&ldquo;bash&rdquo;] #!/bin/sh # This copies the organizational info from /tmp onto the newly imaged HD. # The info is captured when the image process is started and entered by the tech doing the imaging. if [ -d /tmp/tag ]; then mkdir -p &quot;$1/opt/wkstnctl/&quot; cp -R /tmp/tag &quot;$1/opt/wkstnctl/&quot; fi [/code] This simply confirms that the tag directory exists as a directory and then makes the final destination and copies the tag directory to it. This uses the $1 variable available in Casper Imaging to reference the target volume. The system reboots and any packages that need to be installed while booted from the &ldquo;real&rdquo; OS run. Then lastly, our third script runs. This is named zBuildComplete.sh (so it is last) and is set to run on reboot. [code language=&ldquo;bash&rdquo;] #!/bin/sh # Capture when build is complete timezoneoffset=$(cat /Volumes/Macintosh\ HD/opt/wkstnctl/tag/TimeZoneOffset.txt) case &quot;$timezoneoffset&quot; in -0300) starttz=-3 ;; -0400) starttz=-4 ;; -0500) starttz=-5 ;; -600) starttz=-6 ;; -0700) starttz=-7 ;; -0800) starttz=-8 ;; -0900) starttz=-9 ;; -1000) starttz=-10 ;; esac currenttimezoneoffset=$(date +&quot;%z&quot;) case &quot;$currenttimezoneoffset&quot; in -0300) endtz=-3 ;; -0400) endtz=-4 ;; -0500) endtz=-5 ;; -600) endtz=-6 ;; -0700) endtz=-7 ;; -0800) endtz=-8 ;; -0900) endtz=-9 ;; -1000) endtz=-10 ;; sac difference=$(expr $starttz - $endtz) if [ $difference -eq 0 ]; then completionDate=$(date +&quot;%D %H:%M&quot;) elif [ $difference -gt 0 ]; then completionDate=$(date -v &quot;+${difference}H&quot; +&quot;%D %H:%M&quot;) else completionDate=$(date -v &quot;${difference}H&quot; +&quot;%D %H:%M&quot;) fi echo &quot;$completionDate&quot; &gt; /Volumes/Macintosh\ HD/opt/wkstnctl/tag/BuildComplete.txt [/code] This one is a bit messy. First I read the offset stored from the start and use a case statement to convert it to an integer. Then get the current time zone offset and do the same. Now I can calculate the difference between the two. Then I use that difference to generate a build completion time based on the current time. The date command takes a -v option to adjust the time, but that option needs to have the sign of the change explicit. So there is an if statement to format it properly. If the difference is 0, don&rsquo;t use an adjustment, if the difference is positive, print + then the value, else print the value, which will include the - sign. Once that has all been sorted out, store the completion time in our tags.</p>
    </div>
    <a href="/posts/capturing-information-while-running-casper-imaging/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="relative w-100 w-30-l mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/filecruiser-where-are-my-files/" class="link black dim">
        FileCruiser - Where are my files?
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>We are testing a 90-day trial of Promise&rsquo;s <a href="http://www.promise.com/us/Products/FileCruiser">FileCruiser</a>.  It is a private Dropbox look-a-like.  We have been pretty happy with how it works and the performance.  One tricky part is occasionally I have had to try to find the files in the filesystem. If you need to find the data in FileCruiser, it is stored in folders named by a UUID number in <code>/mnt/UserData/MongaStorage/tenants/&lt;UUID&gt;/home/.</code></p>
    </div>
    <a href="/posts/filecruiser-where-are-my-files/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="relative w-100 w-30-l mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/update-to-network-geektool-script-comments/" class="link black dim">
        Update to network GeekTool script
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h4 id="heading"></h4>
<p><a href="https://sneakypockets.wordpress.com/2019/07/29/shell-to-swift-with-a-bit-of-python/" title="">Shell to Swift with a bit of Python | My Thoughts</a> - <!-- raw HTML omitted -->Jul 1, 2019<!-- raw HTML omitted --></p>
<p>[…] want to make this too long. So this will be an overview of the project. For years I have had a shell script that collected some network info and it was displayed on my desktop using NerdTool and then […]</p>
<!-- raw HTML omitted -->
    </div>
    <a href="/posts/update-to-network-geektool-script-comments/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="relative w-100 w-30-l mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/update-to-network-geektool-script/" class="link black dim">
        Update to network GeekTool script
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I have been seeing a lot of noise in my logs about IO80211ScanManager scanning for Wi-Fi networks constantly.  I finally noticed that it was triggered by system_profiler and realized that I was using system_profiler to find my current Wi-Fi network and what channel I was connected to. See the original here: <a href="https://sneakypockets.wordpress.com/2014/08/30/network-services-and-ips/">https://sneakypockets.wordpress.com/2014/08/30/network-services-and-ips/</a> So I changed how I find that data in my GeekTool script.  I also took the opportunity to simplify the whole thing a bit more.  Here is the new version: [code language=&ldquo;bash&rdquo;] #! /bin/bash connection=false services=$(networksetup -listallnetworkservices) while read service; do ip=$(networksetup -getinfo &ldquo;$service&rdquo; | grep &ldquo;IP address&rdquo; | grep -v &ldquo;IPv6&rdquo; | awk &lsquo;{print $3}&rsquo;) if [ &ldquo;$ip&rdquo; != &quot;&quot; ]; then echo &ldquo;$service : $ip&rdquo; connection=true if [ &ldquo;$service&rdquo; == &ldquo;Wi-Fi&rdquo; ]; then NetName=$(/System/Library/PrivateFrameworks/Apple80211.framework/Versions/Current/Resources/airport -I | grep SSID | grep -v BSSID | cut -d&quot;:&quot; -f2 | tr -d &lsquo;[[:space:]]&rsquo;) Channel=$(/System/Library/PrivateFrameworks/Apple80211.framework/Versions/Current/Resources/airport -I | grep channel | cut -d&quot;:&quot; -f2 | tr -d &lsquo;[[:space:]]&rsquo;) echo &ldquo;$NetName / $Channel&rdquo; fi fi done &laquo;&lt;&quot;$services&quot; if [ $connection = false ]; then echo &ldquo;No Connected Services&rdquo; else extIP=$(curl -s <a href="http://checkip.dyndns.org/">http://checkip.dyndns.org/</a> | sed &rsquo;s/[a-zA-Z&lt;&gt;/ :]//g&rsquo;) if [ &ldquo;$extIP&rdquo; != &quot;&quot; ]; then echo &ldquo;External IP: $extIP&rdquo; else echo &ldquo;No External Connection&rdquo; fi fi [/code] Instead of system_profiler the airport command to get the network name and channel.  This stopped the all the message in my logs. I also moved the name and channel logic into the main while read block. This prevents the name and channel from getting separated from the Wi-Fi network IP.</p>
    </div>
    <a href="/posts/update-to-network-geektool-script/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="relative w-100 w-30-l mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/network-services-and-ips-comments/" class="link black dim">
        Network Services and IPs
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h4 id="heading"></h4>
<p><a href="https://sneakypockets.wordpress.com/2015/05/05/update-to-network-geektool-script/" title="">Update to network GeekTool script | My Thoughts</a> - <!-- raw HTML omitted -->May 2, 2015<!-- raw HTML omitted --></p>
<p>I have updated this script to be a bit more efficient and stop spamming my logs. See the new version: <a href="https://sneakypockets.wordpress.com/2015/05/05/update-to-network-geektool-script/">https://sneakypockets.wordpress.com/2015/05/05/update-to-network-geektool-script/</a></p>
<!-- raw HTML omitted -->
    </div>
    <a href="/posts/network-services-and-ips-comments/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="relative w-100 w-30-l mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/network-services-and-ips/" class="link black dim">
        Network Services and IPs
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I have long had a <a href="http://projects.tynsoe.org/en/geektool/" title="GeekTool">GeekTool</a> item on my desktop that tells me what network interfaces were active and what IPs I have on them, as well as my external IP address.  For a long time this relied on ifconfig and manually updating the interface numbers (en0, en1, etc&hellip;).  Now that I have a Retina MBP, without an ethernet port, I have a lot of possible interfaces with the various adapters.  Managing the script manually was getting annoying.  So I rewrote it to use networksetup and a while loop.  The script is below: [code language=&ldquo;bash&rdquo;]#! /bin/bash connection=false services=$(networksetup -listallnetworkservices) while read service; do ip=$(networksetup -getinfo &ldquo;$service&rdquo; | grep &ldquo;IP address&rdquo; | grep -v &ldquo;IPv6&rdquo; | awk &lsquo;{print $3}&rsquo;) if [ &ldquo;$ip&rdquo; != &quot;&quot; ]; then echo &ldquo;$service : $ip&rdquo; connection=true fi done &lt;&lt;&lt;&quot;$services&quot; astatus=$(networksetup -getinfo &ldquo;Wi-Fi&rdquo; | grep &ldquo;IP address&rdquo; | grep -v &ldquo;IPv6&rdquo; | awk &lsquo;{print $3}&rsquo;) if [ &ldquo;$astatus&rdquo; != &quot;&quot; ]; then NetName=`system_profiler SPAirPortDataType | awk &lsquo;/Current Network Information:/ { found=NR } found &amp;&amp; NR==found+1&rsquo; | awk &lsquo;{$1=$1};1&rsquo; | cut -d&quot;:&quot; -f1` Channel=`system_profiler SPAirPortDataType | awk &lsquo;/Current Network Information:/ { found=NR } found &amp;&amp; NR==found+4&rsquo; | awk &lsquo;{$1=$1};1&rsquo; | sed &rsquo;s/Channel/Ch/g&rsquo;` echo &ldquo;$NetName / $Channel&rdquo; fi if [ $connection = false ]; then echo &ldquo;No Connected Services&rdquo; else extIP=$(curl -s <a href="http://checkip.dyndns.org/">http://checkip.dyndns.org/</a> | sed &rsquo;s/[a-zA-Z&lt;&gt;/ :]//g&rsquo;) if [ &ldquo;$extIP&rdquo; != &quot;&quot; ]; then echo &ldquo;External IP: $extIP&rdquo; else echo &ldquo;No External Connection&rdquo; fi fi [/code] The first line gets a list of all network services as defined in the current location in the Network panel of System Preferences, as well as a few other options (bluetooth, usb attached MiFis, etc).  Then for each one of those, we try to look up an IP address.  If there isn&rsquo;t an IP, nothing is displayed, but if there is, then the service name and IP are output. If the Wi-Fi service has an IP address, then the network name and channel that the system is connected to is found and output. Finally, we use a external website to lookup the public IP that our outside connection is from. [Edit] I added some checking so that if there is no connection, it will display that.  Also it will now display if there is no external connection [/Edit] Currently, this is all for IPv4 addresses, and I explicitly exclude any IPv6 addresses that might be assigned, but that could be modified by changing the grep portions of the script. Then in GeekTool I setup a Shell Script item and point it to my script.  That looks like this: <a href="https://sneakypockets.wordpress.com/wp-content/uploads/2014/08/geektool-config.png"><img src="https://sneakypockets.wordpress.com/wp-content/uploads/2014/08/geektool-config.png?w=132" alt="GeekTool config"></a> The output then is positioned in the lower left hand corner of my screen and looks like: <a href="https://sneakypockets.wordpress.com/wp-content/uploads/2014/08/geektool-output1.png"><img src="http://sneakypockets.wordpress.com/wp-content/uploads/2014/08/geektool-output1.png?w=300" alt="GeekTool output"></a> The next step is to use this as an excuse to try out <a href="http://tracesof.net/uebersicht/">Übersicht</a>.</p>
    </div>
    <a href="/posts/network-services-and-ips/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="relative w-100 w-30-l mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/unhide-users-in-10-9-3/" class="link black dim">
        Unhide /Users in 10.9.3
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>[Further Edit] The below was fixed by Apple.  This is no longer necessary, but I&rsquo;ll leave it here incase the ideas help someone. [/Further Edit] [Edit] So the below doesn&rsquo;t actually work. Something changes the permissions and hidden flag after my launch daemon runs. I added a check of the files (just ls &gt; to a file) and they get set correctly but by the time I am logged in something has changed it back. [/edit] The recent 10.9.3 update has made a strange change for a number of OS X users.  The directory that holds everyone&rsquo;s home folder, /Users, has been hidden along with the /Users/Shared folder. A number of people have found a solution using chflags as follows: [code language=&ldquo;bash&rdquo;]sudo chflags nohidden /Users sudo chflags nohidden /Users/Shared[/code] But this doesn&rsquo;t last through a reboot. Not as widely reported, there has also been a permissions change to /Users making it writable by the wheel group and everyone. I have seen an Applescript used as a login item to change the settings back, but this runs every time a user logs in, when the process only needs to run after each reboot.  So I put together another option that uses a launch daemon and a shell script. The shell script is: [code language=&ldquo;bash&rdquo;]#!/bin/sh chmod 755 /Users chflags nohidden /Users chflags nohidden /Users/Shared[/code] This should get saved in /Library/Scripts/fixUsersFolder.sh and then made executable. Then the launchd plist is: [code language=&ldquo;xml&rdquo;]&amp;amp;lt;?xml version=&amp;amp;quot;1.0&amp;amp;quot; encoding=&amp;amp;quot;UTF-8&amp;amp;quot;?&amp;amp;gt; &amp;amp;lt;!DOCTYPE plist PUBLIC &amp;amp;quot;-//Apple//DTD PLIST 1.0//EN&amp;amp;quot; &amp;amp;quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&amp;amp;quot;&amp;amp;gt; &amp;amp;lt;plist version=&amp;amp;quot;1.0&amp;amp;quot;&amp;amp;gt; &amp;amp;lt;dict&amp;amp;gt; &amp;amp;lt;key&amp;amp;gt;Label&amp;amp;lt;/key&amp;amp;gt; &amp;amp;lt;string&amp;amp;gt;com.sneakypockets.fixHidden&amp;amp;lt;/string&amp;amp;gt; &amp;amp;lt;key&amp;amp;gt;Program&amp;amp;lt;/key&amp;amp;gt; &amp;amp;lt;string&amp;amp;gt;/Library/Scripts/fixUsersFolder.sh&amp;amp;lt;/string&amp;amp;gt; &amp;amp;lt;key&amp;amp;gt;RunAtLoad&amp;amp;lt;/key&amp;amp;gt; &amp;amp;lt;true/&amp;amp;gt; &amp;amp;lt;/dict&amp;amp;gt; &amp;amp;lt;/plist&amp;amp;gt; [/code] This should be saved to /Library/LaunchDaemons/com.sneakypockets.fixHidden.plist. Now when you boot your computer, launchd will run the script and put the Users directory and Shared directory back to there old style.</p>
    </div>
    <a href="/posts/unhide-users-in-10-9-3/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
        <div class="relative w-100 w-30-l mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/find-the-most-common-user-on-a-system/" class="link black dim">
        Find the most common user on a system
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>I wrote this shell script for a client that was using JAMF&rsquo;s Casper Suite.  It is in the form of an extended attribute, but can easily be changed to output as you want. The script uses the last command to find all the previous logins and then finds the most common user and reports it.  If less than 10 logins have occurred, the script reports the most recent login.```
#!/bin/sh</p>
    </div>
    <a href="/posts/find-the-most-common-user-on-a-system/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>
</div>

        </div>
      
    </section>
    <ul class="pagination pagination-default">
      <li class="page-item">
        <a href="/posts/" aria-label="First" class="page-link" role="button"><span aria-hidden="true">&laquo;&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/posts/page/3/" aria-label="Previous" class="page-link" role="button"><span aria-hidden="true">&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/posts/" aria-label="Page 1" class="page-link" role="button">1</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/2/" aria-label="Page 2" class="page-link" role="button">2</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/3/" aria-label="Page 3" class="page-link" role="button">3</a>
      </li>
      <li class="page-item active">
        <a aria-current="page" aria-label="Page 4" class="page-link" role="button">4</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/5/" aria-label="Page 5" class="page-link" role="button">5</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/5/" aria-label="Next" class="page-link" role="button"><span aria-hidden="true">&raquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/posts/page/5/" aria-label="Last" class="page-link" role="button"><span aria-hidden="true">&raquo;&raquo;</span></a>
      </li>
    </ul></article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://localhost:1313/" >
    &copy;  Eric Hemmeter 2024 
  </a>
    <div>
<div class="ananke-socials">
  
</div>
</div>
  </div>
</footer>

  </body>
</html>

<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Packaging on My Thoughts</title>
    <link>http://localhost:1313/tags/packaging/</link>
    <description>Recent content in Packaging on My Thoughts</description>
    <generator>Hugo</generator>
    <language>en-us</language>
    <copyright>Eric Hemmeter</copyright>
    <lastBuildDate>Tue, 17 Mar 2020 18:46:06 +0000</lastBuildDate>
    <atom:link href="http://localhost:1313/tags/packaging/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Creating a wrapper package for a choices.xml file</title>
      <link>http://localhost:1313/posts/creating-a-wrapper-package-for-a-choices-xml-file-comments/</link>
      <pubDate>Tue, 17 Mar 2020 18:46:06 +0000</pubDate>
      <guid>http://localhost:1313/posts/creating-a-wrapper-package-for-a-choices-xml-file-comments/</guid>
      <description>&lt;h4 id=&#34;heading&#34;&gt;&lt;/h4&gt;&#xA;&lt;p&gt;&lt;a href=&#34;http://azurecloudsujithcy.wordpress.com&#34; title=&#34;sujith.cy@gmail.com&#34;&gt;azureessentials&lt;/a&gt; - &lt;!-- raw HTML omitted --&gt;Mar 0, 2022&lt;!-- raw HTML omitted --&gt;&lt;/p&gt;&#xA;&lt;p&gt;Thanks for writing this article and it is really helpful. I am trying to distribute ciscoanyconnect app to our Intune managed mac devices. The cisco package we have includes all components like posture, AMP, websecurity etc. I&amp;rsquo;d like to exclude all of them except VPN using choice.xml. I followed your post and after I built the package it fails to run. I suspect there is some issue with the postinstall script. please assist me here.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Creating a wrapper package for a choices.xml file</title>
      <link>http://localhost:1313/posts/creating-a-wrapper-package-for-a-choices-xml-file/</link>
      <pubDate>Tue, 17 Mar 2020 18:46:06 +0000</pubDate>
      <guid>http://localhost:1313/posts/creating-a-wrapper-package-for-a-choices-xml-file/</guid>
      <description>&lt;p&gt;In a &lt;a href=&#34;https://sneakypockets.wordpress.com/2017/07/26/using-installer-choices-xml-to-modify-anyconnect-and-mcafee-deployments/&#34;&gt;previous article&lt;/a&gt;, I discussed creating a choices.xml file to control what gets installed by a vendor package.  I briefly touched on how to use the choices.xml file, but don&amp;rsquo;t give much detail.  In this post, I will spell out how to put the vendor package and choices.xml file in a wrapper package for deployment through anything that handles packages. For my example, I will be using Cisco&amp;rsquo;s AnyConnect 4.8 package and a choices.xml file to only install the VPN portion.  Using &lt;a href=&#34;http://s.sudre.free.fr/Software/Packages/about.html&#34;&gt;Stéphane Sudre&amp;rsquo;s Packages&lt;/a&gt; application, create a new raw package project. &lt;img src=&#34;https://sneakypockets.wordpress.com/wp-content/uploads/2020/03/screen-shot-2020-03-17-at-12.38.06-pm.png&#34; alt=&#34;Screen Shot 2020-03-17 at 12.38.06 PM&#34;&gt; Give it a useful name and decide where to save the project. &lt;img src=&#34;https://sneakypockets.wordpress.com/wp-content/uploads/2020/03/screen-shot-2020-03-17-at-12.38.24-pm.png&#34; alt=&#34;Screen Shot 2020-03-17 at 12.38.24 PM&#34;&gt;You can set Settings how you like, but the defaults generally work for what we are doing. Everything in this exercise will be in the Scripts tab. &lt;img src=&#34;https://sneakypockets.wordpress.com/wp-content/uploads/2020/03/screen-shot-2020-03-17-at-12.58.09-pm.png&#34; alt=&#34;Screen Shot 2020-03-17 at 12.58.09 PM&#34;&gt;Drag the AnyConnect.pkg and your choices.xml to the Additional Resources area.  You can name your xml file anything you want.  For example, I have choicesForAnyConnectVPN.xml and choicesForAnyConnectUmbrella.xml for 2 different package projects.  For AnyConnect, I also want to install our vpn configuration, so I add a Profiles folder with the vpn folder and the configuration in there. &lt;img src=&#34;https://sneakypockets.wordpress.com/wp-content/uploads/2020/03/screen-shot-2020-03-17-at-12.57.51-pm.png&#34; alt=&#34;Screen Shot 2020-03-17 at 12.57.51 PM&#34;&gt; My company&amp;rsquo;s VPN requires a certificate, so that is added as well.&lt;img src=&#34;https://sneakypockets.wordpress.com/wp-content/uploads/2020/03/screen-shot-2020-03-17-at-1.38.57-pm.png&#34; alt=&#34;Screen Shot 2020-03-17 at 1.38.57 PM.png&#34;&gt; The AnyConnect.pkg already looks for the Profiles directory in the same directory as the package. Now we need a post installation script to tell the installer binary to use our choices.xml file.  The first step is to find the path to the resources area, which is created by the installer process and cleaned up automatically.  The post install script will be running from that directory, so we can find the path with &lt;code&gt;​dirname&lt;/code&gt;.  Then we tell installer about the choices.xml, the vendor package, and the target volume.  Lastly, I add the certificate to the System Keychain. &lt;a href=&#34;https://gist.github.com/ehemmete/70396684d6ed91687ec4b7f85aa8961b&#34;&gt;https://gist.github.com/ehemmete/70396684d6ed91687ec4b7f85aa8961b&lt;/a&gt; Once the postinstall.sh is created, drag it to the Post-installation well, save your package, and build it. &lt;img src=&#34;https://sneakypockets.wordpress.com/wp-content/uploads/2020/03/screen-shot-2020-03-17-at-1.39.44-pm.png&#34; alt=&#34;Screen Shot 2020-03-17 at 1.39.44 PM.png&#34;&gt;I then &lt;a href=&#34;https://sneakypockets.wordpress.com/2016/11/04/signing-installer-packages-with-automator/&#34;&gt;sign my packages&lt;/a&gt; with a certificate from my company&amp;rsquo;s Apple developer account. Lastly, a note about the target for &lt;code&gt;installer&lt;/code&gt;. You could put &lt;code&gt;/&lt;/code&gt; in for the target, but if there is a chance this package will be installed while booted from something other than the internal drive (much more common in the era of imaging), the package will be installed to the boot volume, not the correct target.  Using &lt;code&gt;$3&lt;/code&gt; means put it on the target volume.  Rich Trouton mentions it under Installer Script Variables &lt;a href=&#34;https://derflounder.wordpress.com/2014/06/01/understanding-payload-free-packages/&#34;&gt;here&lt;/a&gt;.  There are also mentions in the old PeachPit &lt;a href=&#34;https://books.google.com/books?id=H3awpzaO7IwC&amp;amp;lpg=PA111&amp;amp;dq=%243%20The%20mount%20point%20of%20the%20destination%20volume&amp;amp;pg=PA111#v=onepage&amp;amp;q=$3%20The%20mount%20point%20of%20the%20destination%20volume&amp;amp;f=false&#34;&gt;Mac OS X Deployment&lt;/a&gt; book.  [edit]And thanks to &lt;a href=&#34;https://scriptingosx.com&#34;&gt;Scripting OS X&lt;/a&gt; for the pointer to double quote &lt;code&gt;$3&lt;/code&gt; in the post install script.  In these cases (where it isn&amp;rsquo;t &lt;code&gt;/&lt;/code&gt;) it will likely expand to &lt;code&gt;/Volumes/Macintosh HD/&lt;/code&gt;​ and the space will cause a problem if not quoted.  He also points out that I hard coded the path to the System Keychain, but&lt;code&gt;security&lt;/code&gt; won&amp;rsquo;t be happy if &lt;code&gt;$3&lt;/code&gt; isn&amp;rsquo;t &lt;code&gt;/&lt;/code&gt;, so this isn&amp;rsquo;t as flexible as I intended.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Setting the Screen Saver to a static image</title>
      <link>http://localhost:1313/posts/setting-the-screen-saver-to-a-static-image/</link>
      <pubDate>Fri, 02 Feb 2018 20:28:49 +0000</pubDate>
      <guid>http://localhost:1313/posts/setting-the-screen-saver-to-a-static-image/</guid>
      <description>&lt;p&gt;On our Windows systems we have a static image as our screen saver and I wanted to match that on our Macs.  There are several options in the Screen Saver settings of System Preferences.  I needed to figure out how to set a default across all our Macs with a script.&lt;img src=&#34;https://sneakypockets.wordpress.com/wp-content/uploads/2018/02/screen-shot-2018-02-02-at-1-55-51-pm.png&#34; alt=&#34;Screen Shot 2018-02-02 at 1.55.51 PM.png&#34;&gt;  We wanted a single image statically on the screen.  By making a folder with one image in it, we can use the slideshow options to show our single image. After setting things up the way I wanted, I looked around to see where the settings were stored.  You can use something like &lt;a href=&#34;https://fsmonitor.com&#34;&gt;FSMonitor&lt;/a&gt; to watch what files are edited when you change things in System Preferences.  These settings are per user and per device, so they end up in ~/Library/ByHost/com.apple.screensaver.plist, ~/Library/ByHost/com.apple.ScreenSaver.iLifeSlideShows.plist, and ~/Library/ByHost/com.apple.ScreenSaverPhotoChooser.plist.  If you select other options, you might not need all of these files. To work with this files, use &lt;code&gt;defaults -currentHost read [preference-domain]&lt;/code&gt;. First look at com.apple.screensaver.plist:&lt;code&gt;$ defaults -currentHost read com.apple.screensaver { PrefsVersion = 100; idleTime = 1800; moduleDict =     { moduleName = iLifeSlideshows; path = &amp;quot;/System/Library/Frameworks/ScreenSaver.framework/Resources/iLifeSlideshows.saver&amp;quot;; type = 0; }; }&lt;/code&gt;Then ~/Library/ByHost/com.apple.ScreenSaver.iLifeSlideShows.plist:&lt;code&gt;defaults -currentHost read com.apple.ScreenSaver.iLifeSlideShows { styleKey = Classic; }&lt;/code&gt;Then finally, ~/Library/ByHost/com.apple.ScreenSaverPhotoChooser.plist:&lt;code&gt;defaults -currentHost read com.apple.ScreenSaverPhotoChooser { CustomFolderDict =     { identifier = &amp;quot;/Library/Screen Savers/CompanyName&amp;quot;; name = CompanyName; }; LastViewedPhotoPath = &amp;quot;&amp;quot;; SelectedFolderPath = &amp;quot;/Library/Screen Savers/CompanyName&amp;quot;; SelectedSource = 4; }&lt;/code&gt;To set these, we use a very similar command: &lt;code&gt;defaults -currentHost write [preference-domain] [key] [value]&lt;/code&gt;. After some testing I&amp;rsquo;ve found we just need:```&#xA;#!/bin/sh&#xA;defaults -currentHost write com.apple.screensaver moduleDict -dict moduleName iLifeSlideshows path &amp;ldquo;/System/Library/Frameworks/ScreenSaver.framework/Resources/iLifeSlideshows.saver&amp;rdquo; type 0&#xA;defaults -currentHost write com.apple.ScreenSaver.iLifeSlideShows styleKey Classic&#xA;defaults -currentHost write com.apple.ScreenSaverPhotoChooser SelectedFolderPath &amp;ldquo;/Library/Screen Savers/CompanyName&amp;rdquo;&lt;/p&gt;</description>
    </item>
    <item>
      <title>Using installer choices.xml to modify AnyConnect and McAfee deployments</title>
      <link>http://localhost:1313/posts/using-installer-choices-xml-to-modify-anyconnect-and-mcafee-deployments-comments/</link>
      <pubDate>Thu, 27 Jul 2017 01:37:58 +0000</pubDate>
      <guid>http://localhost:1313/posts/using-installer-choices-xml-to-modify-anyconnect-and-mcafee-deployments-comments/</guid>
      <description>&lt;h4 id=&#34;heading&#34;&gt;&lt;/h4&gt;&#xA;&lt;p&gt;&lt;a href=&#34;http://www.rogers.com&#34; title=&#34;scott.beach@rci.rogers.com&#34;&gt;Scott Beach&lt;/a&gt; - &lt;!-- raw HTML omitted --&gt;Oct 3, 2018&lt;!-- raw HTML omitted --&gt;&lt;/p&gt;&#xA;&lt;p&gt;I&amp;rsquo;ve been looking for this information for exactly these two .pkgs! This is great. Thank very much for it. I&amp;rsquo;ll work on it tomorrow! - Scott Rogers Communications MacAnalyst&lt;/p&gt;&#xA;&lt;!-- raw HTML omitted --&gt;&#xA;&lt;p&gt;[…] showing how to deploy Cisco AnyConnect using Jamf Pro. As part of that documentation, HCS described how to create an installer choices XML file and then use it to create a custom Cisco AnyConnect installer […]&lt;/p&gt;</description>
    </item>
    <item>
      <title>Using installer choices.xml to modify AnyConnect and McAfee deployments</title>
      <link>http://localhost:1313/posts/using-installer-choices-xml-to-modify-anyconnect-and-mcafee-deployments/</link>
      <pubDate>Thu, 27 Jul 2017 01:37:58 +0000</pubDate>
      <guid>http://localhost:1313/posts/using-installer-choices-xml-to-modify-anyconnect-and-mcafee-deployments/</guid>
      <description>&lt;p&gt;[edit] I have written a follow up article explaining how to wrap a vendor package and custom choices.xml in a &lt;a href=&#34;https://sneakypockets.wordpress.com/2020/03/17/creating-a-wrapper-package-for-a-choices-xml-file/&#34;&gt;wrapper package&lt;/a&gt;.[/edit] I have seen several posts on &lt;a href=&#34;https://macadmins.herokuapp.com&#34;&gt;MacAdmin Slack&lt;/a&gt; asking for help deploying only components of big packages that the business wants or needs.  There are often several ways of handling this.  For example, from the McAfee ePO console, your admin can give you a Threat Prevention only installer instead of the full Endpoint Security package.  That is great if you can grab that yourself or the admin is helpful and able to get it for you.  This isn&amp;rsquo;t always the case.  Another route is to install the full package and then uninstall the pieces that you don&amp;rsquo;t want/need.  The Cisco AnyConnect Secure Mobility client installer does put uninstall scripts for each piece of the package in /opt/cisco/anyconnect/bin.  Both of these options can get your Macs to the end state you want, but they do have potential drawbacks/complications.  Using the Apple provided installer command line tool, we can see what options are available in these packages and then create a file to set which pieces we want.  This does take some work upfront, but we have all the tools we need.   To start we need an installer package that has choices.  We will focus on 2, Cisco&amp;rsquo;s AnyConnect Secure Mobility Client 4.3.03086 and McAfee&amp;rsquo;s Endpoint Security for Mac 10.2.1.  The choices show up in the GUI as selectable check boxes. [gallery ids=&amp;ldquo;593,592&amp;rdquo; type=&amp;ldquo;rectangular&amp;rdquo;] To see these choices from the command line and generate the information we need, we use the installer command with the &lt;code&gt;‑showChoicesXML&lt;/code&gt; option and pass it the package we are interested in.  Depending on the package, we may also need to specify the target, so I generally always do.  Be careful with the target.  Some installers will behave differently if some or all of the software is already installed. Installing on a clean system (maybe a VM you can role back) is a good way to see the real default behavior. Notice in the Cisco installer picture above, VPN and WebSecurity are unchecked and grayed out.  That is because my target already has those pieces installed on it. Our command is: &lt;code&gt;installer ‑showChoicesXML ‑pkg /path/to/AnyConnect.pkg ‑target /&lt;/code&gt; That will print a bunch of information to standard out (the terminal window), so I will often redirect it to a file for saving and easier reading/searching like so: &lt;code&gt;installer ‑showChoicesXML ‑pkg /path/to/AnyConnect.pkg ‑target / &amp;gt; ~/Desktop/anyconnect_choices.xml&lt;/code&gt; That will output something like:[gist]542c05e12abb931746cc9811e60fe32d[/gist] Notice the individual dictionaries:[gist]14ad94a01a22cb98a5de9f6f36448247[/gist] This is one of the choices in the package (Umbrella).  Notice that the choiceIsSelected key is set to 1.  This means that by default on this volume (the target from the command), this choice will be installed.  We want to tell the installer command to skip this choice so we want to set choiceIsSelected to 0.  To do that we will create our own xml file that has the values we want.  The keys that we need are the choiceIdentifier, choiceIsSelected, and whether we want the choice to install (set value to 1) or not install (set value to 0).  Our file needs to be valid XML, so we need the appropriate file header.  You can create a valid XML file with the built in defaults command but for this, we can just copy the skeleton of our choices.xml we output from installer.[gist]c7002bd6dba90b136ff48b7a5a3b08eb[/gist] Now we need to add a dictionary for each setting we want to set in this form:[gist]e157915f4e47ce2583eaea71b682cd6d[/gist] We need to match the choiceIdentifier values to the those in the output of the installer command.  This AnyConnect package is setup nicely for easy reading.  Not all packages are (more on that later).  Then we have our choiceAttribute key (the key we want to change from default) set to &amp;lsquo;selected&amp;rsquo; and finally what we want to set that attribute to in the attributeSetting key (in this case we are setting it to 0 so this choice doesn&amp;rsquo;t install). We only need to add entries for things we want to change from the default. In this case the choices file specifies settings for all possible choices. Once we build up our file, we get something like:[gist]8a34f3b7741de31e969e09247b3c31d9[/gist] This file tells &lt;code&gt;installer&lt;/code&gt; to install VPN and skip the rest. Now we are ready to test the package.  To first verify that things look like they will work, we can use the &lt;code&gt;‑showChoicesAfterApplyingChangesXML&lt;/code&gt; option for installer and see what it will try to do. &lt;code&gt;installer ‑showChoicesAfterApplyingChangesXML /path/to/choicesForAnyConnect.xml ‑pkg /path/to/AnyConnect.pkg ‑target /&lt;/code&gt; [gist]9f62ad9b678d20181f6365099c94169c[/gist]In this output we will see more than one entry for each choice.  In this output I have 3, enabled, visible, and selected.  Enabled means will the choice be allowed to be changed in the GUI and visible means will it even show up in the GUI.  We are only worried about selected as we aren&amp;rsquo;t going to use the GUI.  So confirm that the choices we want to install have selected set to 1 and the choices we want to skip have selected set to 0. Once that all looks correct, we can actually deploy with &lt;code&gt;‑applyChoiceChangesXML&lt;/code&gt;.  That looks like &lt;code&gt;installer ‑applyChoiceChangesXML /path/to/choicesForAnyConnect.xml ‑pkg /path/to/AnyConnect.pkg ‑target /&lt;/code&gt; This can be packaged up for deployment through a management tool pretty easily.  Basically you want to put the default package and your choices.xml into the packages resources area and then have a post install script that runs the above command.  There is a lot more detail possible, but that might be another blog post. Cisco&amp;rsquo;s AnyConnect Secure Mobility installer is pretty friendly when it comes to repackaging/making choices.  If we try to apply the above to the McAfee Endpoint Security 10.2.1 installer, we will see some additional complexity. &lt;code&gt;installer ‑showChoicesXML ‑pkg /path/to/McAfee_Endpoint_Security\ 10.2.1/1\ Source/McAfee-Endpoint-Security-for-Mac-10.2.1-RTW-standalone-2632.pkg ‑target /&lt;/code&gt; [gist]6c976037049b701741deb01bce7c660d[/gist] Notice that the choiceIdentifier is the not so helpful installer_choice_5.  We can still see what the choice is by the choiceTitle, but now when we create our choices.xml, we need to be very careful about which choices we are selecting and which we are not.  Your end result will look something like: [gist]c4cb8ef55ce6e11b108fa6a51e48c385[/gist] In this file, installer_choice_5 is the Firewall and installer_choice_6 is Web Control. For this type of package it can be important to save the output of showChoicesXML as a reference for which choice is which. This is an example of only putting in dictionaries for the choices we want to change.  I would say this is probably not a best practice as different systems can end up with different defaults, but it can work.&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
